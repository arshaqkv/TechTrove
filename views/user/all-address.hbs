{{> user-header}}
<div class="container mt-5 mb-5">
  <div class="row">
    <div class="col-md-3">
      {{> profile-nav}}
    </div>
    <div class="col-md-9">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="card-title">Shipping Address</h4>
        <a href="/address/add" class="btn btn-primary" id="addAddressBtn">Add Address</a>
      </div>
      
      <div id="addressList">
        {{#if address.length}}
        {{#each address}}
        <div class="card mb-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <input type="radio" name="defaultAddress" id="{{this._id}}" {{#if this.default}}checked{{/if}}>
                <label for="{{this._id}}">
                  <strong></strong><br>
                  {{addressLine1}}, <br>{{addressLine2}}, <br>{{city}}, {{state}} - {{pinCode}}<br>
                  
                </label>
              </div>
              <div>
                <a href="/address/edit/{{this._id}}" class="btn btn-outline-secondary btn-sm"><i class="fas fa-edit"></i></a>
                {{!-- <a href="/address/delete/{{this._id}}?_method=DELETE" class="btn btn-outline-danger btn-sm"><i class="fas fa-trash"></i></a> --}}
                <form id="deleteForm-{{this._id}}" action="/address/delete/{{this._id}}?_method=DELETE" method="POST" class="d-inline" onsubmit="return showConfirmation(event, '{{this._id}}')">
                    <button class="btn btn-outline-danger btn-sm" type="submit"><i class="fas fa-trash"></i></button>
                </form>
                {{#if this.default}}
                <span class="badge badge-primary">Default</span>
                {{/if}}
              </div>
            </div>
          </div>
        </div>
        {{/each}}
        {{else}}
            <div class="col-12 text-center">
                <h4>Add new Address</h4>
            </div>
        {{/if}}
      </div>
    </div>
  </div>
</div>
<div id="modalOverlay" class="modal-overlay"></div>

<!-- Confirmation modal -->
<div id="confirmationModal" class="confirmation-modal">
    <h2>Confirm Deletion</h2>
    <p>Are you sure you want to delete this Address?</p>
    <div class="buttons">
        <button class="btn btn-danger" id="confirmDeleteButton">Yes</button>
        <button class="btn btn-secondary" onclick="hideConfirmation()">No</button>
    </div>
</div>

<script>
    let currentFormId = null;

    function showConfirmation(event, formId) {
        event.preventDefault();
        currentFormId = formId;
        document.getElementById('modalOverlay').style.display = 'block';
        document.getElementById('confirmationModal').style.display = 'block';
    }

    function hideConfirmation() {
        document.getElementById('modalOverlay').style.display = 'none';
        document.getElementById('confirmationModal').style.display = 'none';
        currentFormId = null;
    }

    document.getElementById('confirmDeleteButton').addEventListener('click', function() {
        if (currentFormId) {
            document.getElementById('deleteForm-' + currentFormId).submit();
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('input[name="defaultAddress"]').forEach(function (radio) {
      radio.addEventListener('change', function () {
        const addressId = this.id
        updateDefaultAddress(addressId);
      });
    });
  });

  function updateDefaultAddress(addressId) {
    fetch(`/address/default/${addressId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ userId: '{{user._id}}' })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        location.reload(); // Reload the page to reflect changes
      } else {
        alert('Failed to update default address');
      }
    })
    .catch(error => console.error('Error:', error));
}
</script>



{{> footer}}